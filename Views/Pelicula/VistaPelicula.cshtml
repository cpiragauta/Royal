@model CinemaPOS.Models.EncabezadoPelicula
@{
    ViewBag.Title = "VistaPelicula";
    Layout = "~/Views/Inicio/Diseño.cshtml";
}

<head>
    <!--jQuery [ REQUIRED ]-->
    <script src="~/Content/js/jquery-2.2.4.min.js"></script>
    <!--DataTables [ OPTIONAL ]-->
    <script src="~/Content/plugins/datatables/media/js/jquery.dataTables.js"></script>
    <script src="~/Content/plugins/datatables/media/js/dataTables.bootstrap.js"></script>
    <script src="~/Content/plugins/datatables/extensions/Responsive/js/dataTables.responsive.min.js"></script>
    <!--DataTables Sample [ SAMPLE ]-->
    <script src="~/Content/js/demo/tables-datatables.js"></script>
</head>
<p>
    <a class="btn btn-success" href='@Url.Action("Pelicula", "Pelicula")'>Crear Película</a>
</p>
    <div class="panel">
        <div class="panel-heading">
            <h3 class="panel-title">Lista Películas</h3>
        </div>
        <div class="panel-body">
            <table id="demo-dt-basic" class="table table-striped table-bordered" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>Titulo local</th>
                        <th>Distribuidor</th>
                        <th class="min-tablet">Estado</th>
                        <th class="min-desktop">Fecha estreno</th>
                        <th>Formato / Versión</th>
                        <th>Género</th>
                        <th>Poster</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (CinemaPOS.Models.EncabezadoPelicula peliculas in ViewBag.Peliculas)
                    {
                        <tr>
                            <td>@peliculas.TituloLocal</td>
                            <td>@peliculas.Tercero.Nombre</td>
                            <td>@peliculas.Estado.Nombre</td>
                            <td>@peliculas.FechaEstreno.Value.ToString("dd/MM/yyyy")</td>
                            <td>
                                <table>
                                    @foreach (CinemaPOS.Models.DetallePelicula detalle_pelicula in peliculas.DetallePelicula)
                                    {
                                        <tr>
                                            <td>@detalle_pelicula.Opcion.Nombre</td>
                                            <td>@detalle_pelicula.Opcion1.Nombre</td>
                                        </tr>
                                    }
                                </table>
                            </td>
                            <td>
                                <table>
                                    @foreach (CinemaPOS.Models.GeneroPelicula generos in peliculas.GeneroPelicula)
                                    {
                                        <tr>
                                            <td>@generos.Opcion.Nombre</td>
                                        </tr>
                                    }
                                </table>
                            </td>
                            <td>
                                @if (peliculas.MedioPelicula.Count != 0)
                                {
                                    if(@peliculas.MedioPelicula.ToList().OrderByDescending(m => m.RowID).FirstOrDefault().Afiche != "" || @peliculas.MedioPelicula.ToList().OrderByDescending(m => m.RowID).FirstOrDefault().AficheMiniatura != "") {
                                    <img style="width:50px;" src="/@peliculas.MedioPelicula.ToList().OrderByDescending(m => m.RowID).FirstOrDefault().Afiche">
                                  }
                                  else { 
                                    <img style="width:50px;" src="~/Repositorio_Imagenes/Imagenes_Generales/nodisponible.png">
                                  }
                                }
                            </td>
                            <td><a href="@Url.Action("Pelicula", "Pelicula", new { @RowID_Pelicula =peliculas.RowID})"><i class="glyphicon glyphicon-pencil"></i></a></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>